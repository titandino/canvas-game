function Asteroids(){Level.call(this),this.background=this.addGameObject(new GameObject("#000000",canvas.width/2,canvas.height/2,canvas.height>canvas.width?canvas.height:canvas.width,-1)),this.player=this.addGameObject(new Ship("ship.png",canvas.width/2,canvas.height/2,20)),this.player.shield=this.addGameObject(new GameObject("#00FFFF",0,0,50,1)),this.player.shield.visible=!1,this.asteroids=[],this.spawnTime=9,this.timer=0,this.score=0}function PowerUp(a,b,c){GameObject.call(this,this.getSpriteByType(a),b,c,30),this.type=a}function StartMenu(){Level.call(this),this.timer=1,this.background=this.addGameObject(new GameObject("#000000",canvas.width/2,canvas.height/2,canvas.height>canvas.width?canvas.height:canvas.width,-1)),this.logo=this.addGameObject(new GameObject("logo.png",canvas.width/2,canvas.height/2-100,400)),this.playButton=this.addGameObject(new GameObject("play.png",canvas.width/2-200,canvas.height/2,100)),this.controlsButton=this.addGameObject(new GameObject("controls.png",canvas.width/2+200,canvas.height/2,100))}function ControlsMenu(){Level.call(this),this.background=this.addGameObject(new GameObject("#000000",canvas.width/2,canvas.height/2,canvas.height>canvas.width?canvas.height:canvas.width,-1)),this.controls=this.addGameObject(new GameObject("controlsbg.png",canvas.width/2,canvas.height/2,canvas.height<canvas.width?canvas.height:canvas.width)),this.backButton=this.addGameObject(new GameObject("back.png",canvas.width/2+200,canvas.height/2+200,100))}function LossMenu(a){Level.call(this),this.score=a,this.background=this.addGameObject(new GameObject("#000000",canvas.width/2,canvas.height/2,canvas.height>canvas.width?canvas.height:canvas.width,-1)),this.backButton=this.addGameObject(new GameObject("back.png",canvas.width/2+200,canvas.height/2+200,100))}function Bullet(a,b,c,d){GameObject.call(this,a,b,c,d)}function Ship(a,b,c,d){GameObject.call(this,a,b,c,d),this.health=100,this.timeBetweenShots=.5,this.shotTimer=0,this.turnSpeed=3,this.speed=80,this.powerups=[0,0,0]}function Asteroid(a,b,c){GameObject.call(this,"asteroid.png",a,b,c)}function Level(){this.gameObjects=[],this.particleSystems=[]}function Particle(a,b,c,d){GameObject.call(this,a,b,c,d),this.life=0,this.hasLife=!1,this.rotation=getRandomFloat(-5,5)}function ParticleSystem(a,b,c,d,e,f,g,h,i,j,k,l,m,n){this.x=b,this.y=c,this.lifetime=d,this.sprite=a,this.gameObjects=[],this.created=!1,this.hasLife=!0,this.numParticles=e,this.minSize=f,this.maxSize=g,this.minSpeed=h,this.maxSpeed=i,this.minX=j,this.maxX=k,this.minY=l,this.maxY=m,this.gravity=n,0==this.lifetime&&(this.hasLife=!1)}function Vector2(a,b){this.x=a,this.y=b}function getLocalMousePos(a,b){var c=a.getBoundingClientRect();return{x:(b.clientX-c.left)/(c.right-c.left)*a.width,y:(b.clientY-c.top)/(c.bottom-c.top)*a.height}}function drawText(a,b,c,d,e,f,g){ctx.fillStyle=d,ctx.font=(e||"12px")+" "+(f||"Helvetica"),ctx.textAlign=g||"left",ctx.textBaseline="top",ctx.fillText(a,b,c)}function getRandomFloat(a,b){return Math.random()*(b-a)+a}function getRandom(a,b){return Math.floor(Math.random()*(b-a)+a)}function switchLevel(a){currentLevel.unload(),currentLevel=a}function update(a){currentLevel.updateObjects(a),currentLevel.update(a)}function render(){ctx.clearRect(0,0,canvas.width,canvas.height),currentLevel.renderObjects(),currentLevel.render()}function main(){var a=Date.now(),b=a-then;update(b/1e3),render(),then=a}function imageLoaded(a){for(var b=0;b<LOADED_IMAGES.length;b++)if(LOADED_IMAGES[b].src===a)return b;return-1}function keepImage(a){imageLoaded(a.src)||LOADED_IMAGES.push(a)}function GameObject(a,b,c,d,e){if(a&&!a.startsWith("#")){if(imageLoaded(a)===-1){var f=new Image;f.onload=keepImage(f),f.src="sprites/"+a,this.sprite=f}else this.sprite=LOADED_IMAGES[imageLoaded(a)];this.hasSprite=!0}else this.sprite=a,this.hasSprite=!1;this.scale=d,this.x=b,this.y=c,this.rotation=0,this.angularVelocity=0,this.gravity=null,this.visible=!0,this.hasMovement=!0,this.transparency=1,this.zIndex=e||0,this.deleteOnViewportExit=!1,this.acceleration=new Vector2(0,0),this.velocity=new Vector2(0,0)}Asteroids.prototype=Object.create(Level.prototype),Asteroids.prototype.update=function(a){this.timer>0?this.timer-=a:(this.spawnWave(),this.timer=this.spawnTime)},Asteroids.prototype.spawnWave=function(){this.spawnPowerUp();for(var a=0;a<5;a++)this.spawnAsteroid()},Asteroids.prototype.spawnPowerUp=function(){this.addGameObject(new PowerUp(getRandom(0,this.player.powerups.length),getRandom(50,canvas.width),getRandom(50,canvas.height)))},Asteroids.prototype.spawnAsteroid=function(){var a=getRandom(0,5),b=new Asteroid(0,0,getRandom(25,75));a<=1?(b.x=0,b.y=0,b.velocity=new Vector2(getRandomFloat(10,50),getRandomFloat(10,50))):2===a?(b.x=0,b.y=canvas.height,b.velocity=new Vector2(getRandomFloat(10,50),getRandomFloat(-10,-50))):3===a?(b.x=canvas.width,b.y=canvas.height,b.velocity=new Vector2(getRandomFloat(-10,-50),getRandomFloat(-10,-50))):(b.x=canvas.width,b.y=0,b.velocity=new Vector2(getRandomFloat(-10,-50),getRandomFloat(10,50))),b.angularVelocity=getRandomFloat(-2,2),this.asteroids.push(this.addGameObject(b))},Asteroids.prototype.render=function(){drawText("Ship health: "+this.player.health,20,20,"#00FF00"),drawText("Score: "+this.score,20,32,"#00FF00"),DEBUG&&(drawText("Game object buffer len: "+this.gameObjects.length,20,44,"#00FF00"),drawText("Game objects: "+this.objectCount(),20,56,"#00FF00"))},PowerUp.prototype=new GameObject;var POWERUP_TRISHOT=0,POWERUP_SHOT_SPEED=1,POWERUP_INVULNERABILITY=2;PowerUp.prototype.update=function(){currentLevel.player.rectCollide(this)&&(currentLevel.addParticleSystem(new ParticleSystem("#00FFFF",this.x,this.y,2,25,5,15,40,80,-50,50,-50,50)),currentLevel.player.powerups[this.type]=15,currentLevel.removeGameObject(this))},PowerUp.prototype.getSpriteByType=function(a){switch(a){case 0:return"trishot.png";case 1:return"shotspeed.png";case 2:return"invulnerability.png";default:return"#00FF00"}},StartMenu.prototype=Object.create(Level.prototype),StartMenu.prototype.update=function(a){this.timer>0&&(this.timer-=a),this.timer<=0&&(this.spawnAsteroid(),this.timer=1)},StartMenu.prototype.onMouseDown=function(){this.playButton.pointCollide(mousePos.x,mousePos.y)?switchLevel(new Asteroids):this.controlsButton.pointCollide(mousePos.x,mousePos.y)&&switchLevel(new ControlsMenu)},StartMenu.prototype.spawnAsteroid=function(){var a=getRandom(0,5),b=new Particle("asteroid.png",0,0,getRandom(25,75));a<=1?(b.x=0,b.y=0,b.velocity=new Vector2(getRandomFloat(10,50),getRandomFloat(10,50))):2===a?(b.x=0,b.y=canvas.height,b.velocity=new Vector2(getRandomFloat(10,50),getRandomFloat(-10,-50))):3===a?(b.x=canvas.width,b.y=canvas.height,b.velocity=new Vector2(getRandomFloat(-10,-50),getRandomFloat(-10,-50))):(b.x=canvas.width,b.y=0,b.velocity=new Vector2(getRandomFloat(-10,-50),getRandomFloat(10,50))),b.angularVelocity=getRandomFloat(-2,2),this.addGameObject(b)},ControlsMenu.prototype=Object.create(Level.prototype),ControlsMenu.prototype.onMouseDown=function(){this.backButton.pointCollide(mousePos.x,mousePos.y)&&switchLevel(new StartMenu)},LossMenu.prototype=Object.create(Level.prototype),LossMenu.prototype.render=function(){drawText("YOUR SHIP WAS DESTROYED",canvas.width/2,canvas.height/2-200,"#00FF00","50px","Helvetica","center"),drawText("FINAL SCORE: "+this.score,canvas.width/2,canvas.height/2,"#00FF00","50px","Helvetica","center")},LossMenu.prototype.onMouseDown=function(){this.backButton.pointCollide(mousePos.x,mousePos.y)&&switchLevel(new StartMenu)},Bullet.prototype=Object.create(GameObject.prototype),Bullet.prototype.update=function(){for(var a=0;a<currentLevel.asteroids.length;a++)currentLevel.asteroids[a]&&this.rectCollide(currentLevel.asteroids[a])&&(currentLevel.removeGameObject(this),currentLevel.removeGameObject(currentLevel.asteroids[a]),currentLevel.asteroids[a].processHit(a),delete currentLevel.asteroids[a]);this.getLeftBound()>=canvas.width&&currentLevel.removeGameObject(this),this.getRightBound()<=0&&currentLevel.removeGameObject(this),this.getTopBound()>=canvas.height&&currentLevel.removeGameObject(this),this.getBottomBound()<=0&&currentLevel.removeGameObject(this)},Ship.prototype=Object.create(GameObject.prototype),Ship.prototype.removeHealth=function(a){this.powerups[POWERUP_INVULNERABILITY]<=0&&(this.health-=a),this.health<=0&&(switchLevel(new LossMenu(currentLevel.score)),this.health=-1)},Ship.prototype.fireBullet=function(){var a=new Vector2(Math.sin(this.rotation),-Math.cos(this.rotation)).multiplyByScalar(this.scale),b=new Bullet("#FF0000",this.x+a.x,this.y+a.y,5);if(b.velocity=a.normalize().multiplyByScalar(800),currentLevel.addGameObject(b),this.powerups[POWERUP_TRISHOT]>0){var c=new Vector2(Math.sin(this.rotation-.2),-Math.cos(this.rotation-.2)).multiplyByScalar(this.scale),d=new Bullet("#FF0000",this.x+c.x,this.y+c.y,5);d.velocity=c.normalize().multiplyByScalar(800),currentLevel.addGameObject(d);var e=new Vector2(Math.sin(this.rotation+.2),-Math.cos(this.rotation+.2)).multiplyByScalar(this.scale),f=new Bullet("#FF0000",this.x+e.x,this.y+e.y,5);f.velocity=e.normalize().multiplyByScalar(800),currentLevel.addGameObject(f)}this.shotTimer=this.timeBetweenShots,this.powerups[POWERUP_SHOT_SPEED]>0&&(this.shotTimer/=5)},Ship.prototype.update=function(a){this.shotTimer>0&&(this.shotTimer-=a);for(var b=0;b<this.powerups.length;b++)this.powerups[b]>0&&(this.powerups[b]-=a);this.shield.x=this.x,this.shield.y=this.y,this.powerups[POWERUP_INVULNERABILITY]>5?(this.shield.visible=!0,this.shield.transparency=.4):this.powerups[POWERUP_INVULNERABILITY]>0?(this.shield.visible=!0,this.shield.transparency>.4?this.shield.incrementing=!1:this.shield.transparency<=.1&&(this.shield.incrementing=!0),this.shield.transparency+=this.shield.incrementing?a/2:-(a/2)):this.shield.visible=!1;for(var b=0;b<currentLevel.asteroids.length;b++)currentLevel.asteroids[b]&&this.rectCollide(currentLevel.asteroids[b])&&(this.removeHealth(getRandom(5,9)),currentLevel.addParticleSystem(new ParticleSystem("asteroid.png",currentLevel.asteroids[b].x,currentLevel.asteroids[b].y,2,25,5,15,40,80,-50,50,-50,50)),currentLevel.removeGameObject(currentLevel.asteroids[b]),delete currentLevel.asteroids[b]);var c=.6,d=.995;if(this.acceleration.x*=c,this.acceleration.y*=c,this.velocity.x*=d,this.velocity.y*=d,keysDown[32]&&this.shotTimer<=0&&this.fireBullet(),keysDown[68]?this.rotation+=this.turnSpeed*a:keysDown[65]&&(this.rotation-=this.turnSpeed*a),keysDown[87]){var e=new Vector2(-Math.sin(this.rotation),Math.cos(this.rotation)).multiplyByScalar(this.scale);this.acceleration=new Vector2(Math.sin(this.rotation),-Math.cos(this.rotation)).multiplyByScalar(this.speed),currentLevel.addParticleSystem(new ParticleSystem("fire.png",this.x+e.x,this.y+e.y,2,2,5,15,40,80,10*e.x-50,10*e.x+50,10*e.y-50,10*e.y+50))}else keysDown[83]&&(this.acceleration=new Vector2(-Math.sin(this.rotation),Math.cos(this.rotation)).multiplyByScalar(this.speed));this.getLeftBound()>=canvas.width&&(this.x=1),this.getRightBound()<=0&&(this.x=canvas.width-1),this.getTopBound()>=canvas.height&&(this.y=1),this.getBottomBound()<=0&&(this.y=canvas.height-1)},Asteroid.prototype=Object.create(GameObject.prototype),Asteroid.prototype.update=function(){this.getLeftBound()>=canvas.width&&currentLevel.removeGameObject(this),this.getRightBound()<=0&&currentLevel.removeGameObject(this),this.getTopBound()>=canvas.height&&currentLevel.removeGameObject(this),this.getBottomBound()<=0&&currentLevel.removeGameObject(this)},Asteroid.prototype.processHit=function(){if(currentLevel.addParticleSystem(new ParticleSystem("asteroid.png",this.x,this.y,2,25,5,15,40,80,-50,50,-50,50)),currentLevel.score+=Math.floor(100-this.scale),this.scale>=40)for(var a=0;a<getRandom(2,4);a++){var b=new Asteroid(this.x,this.y,this.scale/2);b.velocity=this.velocity.getRotatedBy(getRandomFloat(-1,1)),currentLevel.asteroids.push(currentLevel.addGameObject(b))}},Level.prototype.objectCount=function(){for(var a=0,b=0;b<this.gameObjects.length;b++)this.gameObjects[b]&&a++;return a},Level.prototype.addParticleSystem=function(a){return this.particleSystems.push(a),a},Level.prototype.removeParticleSystem=function(a){var b=this.particleSystems.indexOf(a);if(b){for(var c=0;c<this.particleSystems[b].gameObjects.length;c++)this.particleSystems[b].gameObjects[c]&&this.removeGameObject(this.particleSystems[b].gameObjects[c]);delete this.particleSystems[b]}},Level.prototype.addGameObject=function(a){for(var b=!1,c=0;c<this.gameObjects.length;c++)if(!this.gameObjects[c]){this.gameObjects[c]=a,b=!0;break}return b||this.gameObjects.push(a),a},Level.prototype.removeGameObject=function(a){var b=this.gameObjects.indexOf(a);b&&delete this.gameObjects[b]},Level.prototype.updateObjects=function(a){if(this.gameObjects.sort(function(a,b){return a.zIndex-b.zIndex}),this.gameObjects)for(var b=0;b<this.gameObjects.length;b++)this.gameObjects[b]?(this.gameObjects[b].updatePhysics(a),this.gameObjects[b].update(a)):this.gameObjects.splice(b,1);if(this.particleSystems)for(var b=0;b<this.particleSystems.length;b++)this.particleSystems[b]&&this.particleSystems[b].update(a)},Level.prototype.renderObjects=function(){if(this.gameObjects)for(var a=0;a<this.gameObjects.length;a++)this.gameObjects[a]&&(this.gameObjects[a].render(),this.gameObjects[a].renderExtra())},Level.prototype.unload=function(){if(this.gameObjects)for(var a=0;a<this.gameObjects.length;a++)this.gameObjects[a]&&this.removeGameObject(this.gameObjects[a]);if(this.particleSystems)for(var a=0;a<this.particleSystems.length;a++)this.particleSystems[a]&&this.removeGameObject(this.particleSystems[a])},Level.prototype.update=function(){},Level.prototype.render=function(){},Level.prototype.onMouseDown=function(){},Level.prototype.onMouseMove=function(){},Particle.prototype=Object.create(GameObject.prototype),Particle.prototype.setLife=function(a){this.life=a,this.hasLife=!0},Particle.prototype.update=function(a){this.hasLife&&(this.life<=0?currentLevel.removeGameObject(this):this.life-=a),this.getLeftBound()>=canvas.width&&currentLevel.removeGameObject(this),this.getRightBound()<=0&&currentLevel.removeGameObject(this),this.getTopBound()>=canvas.height&&currentLevel.removeGameObject(this),this.getBottomBound()<=0&&currentLevel.removeGameObject(this)},ParticleSystem.prototype.update=function(a){this.hasLife&&(this.lifetime<=0?currentLevel.removeParticleSystem(this):this.lifetime-=a);for(var b=0;b<this.gameObjects.length;b++)this.gameObjects[b]&&(this.gameObjects[b].transparency-.01>0?this.gameObjects[b].transparency-=.01:this.gameObjects[b].transparency=0);if(!this.created){for(var b=0;b<this.numParticles;b++){var c=new Particle(this.sprite,this.x,this.y,getRandomFloat(this.minSize,this.maxSize));c.velocity=new Vector2(getRandomFloat(this.minX,this.maxX),getRandomFloat(this.minY,this.maxY)).normalize();var d=getRandomFloat(this.minSpeed,this.maxSpeed);c.velocity.multiplyByScalar(d),this.gravity&&(c.gravity=this.gravity),this.gameObjects.push(c),currentLevel.addGameObject(c)}this.created=!0}},Vector2.prototype.normalize=function(){var a=Math.sqrt(this.x*this.x+this.y*this.y);return 0!=a&&(this.x/=a,this.y/=a),this},Vector2.prototype.getMagnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},Vector2.prototype.dot=function(a){return this.x*a.x+this.y*a.y},Vector2.prototype.add=function(a){return this.x+=a.x,this.y+=a.y,this},Vector2.prototype.subtract=function(a){return this.x-=a.x,this.y-=a.y,this},Vector2.prototype.mul=function(a){return this.x*=a.x,this.y*=a.y,this},Vector2.prototype.multiplyByScalar=function(a){return this.x*=a,this.y*=a,this},Vector2.prototype.getRotatedBy=function(a){return new Vector2(this.x*Math.cos(a)-this.y*Math.sin(a),this.x*Math.sin(a)+this.y*Math.cos(a))},Vector2.prototype.reflect=function(a){return a.multiplyByScalar(2*this.dot(a)),this.subtract(a),this.normalize(),this};var canvas=document.getElementById("game-canvas");canvas||console.log("No canvas found.");var ctx=canvas.getContext("2d");canvas.width=window.innerWidth,canvas.height=window.innerHeight;var FPS=60,DEBUG=!1,currentLevel=new StartMenu,keysDown=[],mousePos={x:0,y:0};canvas.addEventListener("mousedown",function(a){mousePos=getLocalMousePos(canvas,a),currentLevel.onMouseDown()},!1),canvas.addEventListener("mousemove",function(a){mousePos=getLocalMousePos(canvas,a)},!1),window.addEventListener("keydown",function(a){switch(keysDown[a.keyCode]=!0,a.keyCode){case 37:case 39:case 38:case 40:case 32:a.preventDefault()}},!1),window.addEventListener("keyup",function(a){keysDown[a.keyCode]=!1},!1);var then=Date.now();setInterval(main,1e3/FPS);var LOADED_IMAGES=[];GameObject.prototype.updatePhysics=function(a){this.hasMovement&&(this.gravity&&this.velocity.add(this.gravity.multiplyByScalar(this.gravity,a)),this.velocity.x+=this.acceleration.x*a,this.velocity.y+=this.acceleration.y*a,this.x+=this.velocity.x*a,this.y+=this.velocity.y*a),this.rotation+=this.angularVelocity*a,this.deleteOnViewportExit&&(this.getLeftBound()>=canvas.width&&currentLevel.removeGameObject(this),this.getRightBound()<=0&&currentLevel.removeGameObject(this),this.getTopBound()>=canvas.height&&currentLevel.removeGameObject(this),this.getBottomBound()<=0&&currentLevel.removeGameObject(this))},GameObject.prototype.update=function(){},GameObject.prototype.render=function(){this.visible&&(ctx.globalAlpha=this.transparency,ctx.translate(this.x,this.y),ctx.rotate(this.rotation),this.hasSprite?ctx.drawImage(this.sprite,-(this.scale/2),-(this.scale*(this.sprite.height/this.sprite.width)/2),this.scale,this.scale*(this.sprite.height/this.sprite.width)):(ctx.fillStyle=this.sprite,ctx.fillRect(-this.scale/2,-this.scale/2,this.scale,this.scale)),ctx.rotate(-this.rotation),ctx.translate(-this.x,-this.y),ctx.globalAlpha=1)},GameObject.prototype.renderExtra=function(){},GameObject.prototype.getWidth=function(){return this.scale},GameObject.prototype.getHeight=function(){return this.hasSprite&&this.sprite?this.scale*(this.sprite.height/this.sprite.width):this.scale},GameObject.prototype.getLeftBound=function(){return this.x-this.getWidth()/2},GameObject.prototype.getRightBound=function(){return this.x+this.getWidth()/2},GameObject.prototype.getTopBound=function(){return this.y-this.getHeight()/2},GameObject.prototype.getBottomBound=function(){return this.y+this.getHeight()/2},GameObject.prototype.pointCollide=function(a,b){return this.getLeftBound()<=a&&a<=this.getRightBound()&&this.getTopBound()<=b&&b<=this.getBottomBound()},GameObject.prototype.rectCollide=function(a){return this.getLeftBound()<=a.getRightBound()&&a.getLeftBound()<=this.getRightBound()&&this.getTopBound()<=a.getBottomBound()&&a.getTopBound()<=this.getBottomBound()};